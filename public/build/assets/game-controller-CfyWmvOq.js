class m{constructor(){this.dragAndDrop=new DragAndDrop("[drag-item]","[drop-item]",this.onCardDropped.bind(this)),this.winGame=new WinGame,this.mainDeck=document.querySelector("#main_deck"),this.mainDeckShown=document.querySelector("#main_deck_shown"),this.init()}init(){this.handleClickMainDeck=this.handleClickMainDeck.bind(this),this.mainDeck.addEventListener("click",this.handleClickMainDeck)}onCardDropped(d,r){const c=d.nextDraggingElements,t=d.target;let a=[];c.forEach(n=>{let e={};e.uuid=n.getAttribute("card-uuid"),e.deck=n.getAttribute("card-deck"),e.deckType="deck",n.parentNode.classList.contains("pile-deck")&&(e.deckType="pile"),a.push(e)});let i={};i.uuid=t.getAttribute("card-uuid"),i.deck=t.parentNode.getAttribute("card-deck"),i.deckType="deck",t.parentNode.classList.contains("pile-deck")&&(i.deckType="pile"),Livewire.dispatch("update-dropped-cards",{droppedCards:a,dropSlot:i});const h=Livewire.on("update-dropped-cards-callback",n=>{const e=n[0];if(r&&typeof r=="function"&&r(e.can_be_dropped),e.next_card_to_be_shown!==null&&e.next_card_to_be_shown!==void 0){const s=k.buildNodeFromHtml(e.next_card_to_be_shown),l=c[0],p=l.getAttribute("card-deck"),o=parseInt(l.getAttribute("card-index"))-1;s.setAttribute("card-deck",p),s.setAttribute("card-index",o),s.classList.remove("card-index-0"),s.classList.add("card-index-"+o),document.querySelector('.other-decks [card-deck="'+p+'"] [card-index="'+o+'"]').replaceWith(s),this.dragAndDrop.reset()}h()})}async handleClickMainDeck(d){Livewire.dispatch("main-deck-next-card");const r=Livewire.on("main-deck-next-card-callback",c=>{const t=c[0];if(t.deck_is_empty)this.resetMainDeck();else{const a=k.buildNodeFromHtml(c[0].card);t.last_deck_card&&(this.mainDeck.querySelector(".poker-card").style.display="none"),this.mainDeckShown.appendChild(a),this.dragAndDrop.reset()}r()})}resetMainDeck(){Livewire.dispatch("reset-main-deck");const d=Livewire.on("reset-main-deck-callback",r=>{this.mainDeckShown.querySelectorAll(".poker-card").forEach((t,a)=>{t.remove()}),this.mainDeck.querySelector(".poker-card").removeAttribute("style"),this.resetDragAndDrop(),d()})}resetDragAndDrop(){this.dragAndDrop.reset()}}class k{static buildNodeFromHtml(d){return document.createRange().createContextualFragment(d).firstElementChild}static winFx(){}}window.GameController=m;
