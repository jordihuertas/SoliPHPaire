class d{constructor(e,s){this.draggableSelector=e,this.droppableSelector=s,this.draggingElement=null,this.prevDraggingElement=null,this.nextDraggingElements=[],this.offsetX=0,this.offsetY=0,this.originalParentNode=null,this.originalPosition={top:0,left:0},this.target=null,this.cssClass={card:"poker-card",dragging:"poker-card--dragging",selected:"poker-card--selected",selectedStack:"poker-card--selected__stack",animating:"poker-card--animating"},this.handleMouseOver=this.handleMouseOver.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.init()}init(){this.draggableCards=document.querySelectorAll(this.draggableSelector),this.droppableSlots=document.querySelectorAll(this.droppableSelector),this.attachEventListeners()}attachEventListeners(){this.draggableCards.forEach(e=>{e.addEventListener("mouseover",this.handleMouseOver),e.addEventListener("mouseleave",this.handleMouseLeave),e.addEventListener("mousedown",this.handleMouseDown)})}removeAllEventListeners(){this.draggableCards.forEach(e=>{e.removeEventListener("mouseover",this.handleMouseOver),e.removeEventListener("mouseleave",this.handleMouseLeave),e.removeEventListener("mousedown",this.handleMouseDown)})}handleMouseOver(e){e.target.classList.add(this.cssClass.selected),r.getNextSiblings(e.target,`.${this.cssClass.card}`).forEach(t=>t.classList.add(this.cssClass.selectedStack))}handleMouseLeave(e){e.target.classList.remove(this.cssClass.selected),r.getNextSiblings(e.target,`.${this.cssClass.card}`).forEach(t=>t.classList.remove(this.cssClass.selectedStack))}handleMouseDown(e){e.preventDefault(),this.draggingElement=e.target,this.prevDraggingElement=e.target.previousElementSibling||null,this.draggingElement.classList.remove(this.cssClass.selected),this.nextDraggingElements=r.getNextSiblings(this.draggingElement,`.${this.cssClass.card}`);const s=this.draggingElement.getBoundingClientRect();this.offsetX=e.clientX-s.left,this.offsetY=e.clientY-s.top,this.originalParentNode=this.draggingElement.parentNode,this.originalPosition={top:s.top,left:s.left},this.draggingElement.classList.add(this.cssClass.dragging),this.nextDraggingElements.forEach(t=>t.classList.add(this.cssClass.dragging,this.cssClass.selectedStack)),r.fixCardPosition(this.draggingElement,e,this.offsetX,this.offsetY),r.fixStackedCardsPosition(this.nextDraggingElements,e,this.offsetX,this.offsetY),e.target.removeEventListener("mouseover",this.handleMouseOver),e.target.removeEventListener("mouseleave",this.handleMouseLeave),this.nextDraggingElements.forEach(t=>{t.removeEventListener("mouseover",this.handleMouseOver),t.removeEventListener("mouseleave",this.handleMouseLeave),t.removeEventListener("mousedown",this.handleMouseDown)}),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}handleMouseMove(e){this.draggingElement&&(r.fixCardPosition(this.draggingElement,e,this.offsetX,this.offsetY),r.fixStackedCardsPosition(this.nextDraggingElements,e,this.offsetX,this.offsetY),this.checkCollision())}async handleMouseUp(e){if(document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.draggingElement){if(!this.target){this.nextDraggingElements.unshift(this.draggingElement),await r.moveElementsTo(this.nextDraggingElements,this.originalPosition),this.nextDraggingElements.forEach(i=>{i.classList.remove("poker-card--selected","poker-card--selected__stack"),i.removeAttribute("style"),i.setAttribute("drop-item","true"),this.originalParentNode.appendChild(i)}),this.reset();return}let s=this.target.getAttribute("card-index")||0,t=parseInt(s);this.nextDraggingElements.unshift(this.draggingElement);const a=this.target.getBoundingClientRect(),n={top:a.top+20,left:a.left};await r.moveElementsTo(this.nextDraggingElements,n),this.nextDraggingElements.forEach((i,l)=>{i.classList.remove("poker-card--selected","poker-card--selected__stack");const h=i.getAttribute("card-index");i.classList.remove("card-index-"+h),i.classList.remove(this.cssClass.dragging),i.removeAttribute("style"),this.target.parentNode.appendChild(i),i.classList.add("card-index-"+ ++t),i.setAttribute("card-index",t),l+1===this.nextDraggingElements.length&&i.setAttribute("drop-item","true")}),this.target.removeAttribute("drop-item"),this.prevDraggingElement&&this.prevDraggingElement.setAttribute("drop-item","true"),this.droppableSlots.forEach(i=>i.classList.remove(this.cssClass.selected)),this.reset()}}checkCollision(){if(!this.draggingElement)return;const e=this.draggingElement.getBoundingClientRect();let s=null,t=1/0;this.droppableSlots=document.querySelectorAll(this.droppableSelector),this.droppableSlots.forEach(a=>{if(a!==this.draggingElement&&a.hasAttribute("drop-item")){const n=a.getBoundingClientRect();if(e.left<n.right&&e.right>n.left&&e.top<n.bottom&&e.bottom>n.top){const i=r.calculateDistance(e,n);i<t&&(t=i,s=a)}}}),this.droppableSlots.forEach(a=>a.classList.remove(this.cssClass.selected)),s?(s.classList.add(this.cssClass.selected),this.target=s):this.target=null}reset(){this.draggingElement=null,this.prevDraggingElement=null,this.nextDraggingElements=[],this.offsetX=0,this.offsetY=0,this.originalParentNode=null,this.originalPosition={top:0,left:0},this.target=null,this.removeAllEventListeners(),this.init()}}class r{static getNextSiblings(e,s){let t=[];for(;e=e.nextSibling;)e.matches&&e.matches(s)&&t.push(e);return t}static fixCardPosition(e,s,t,a){e.style.position="fixed",e.style.left=`${s.clientX-t}px`,e.style.top=`${s.clientY-a}px`,e.style.zIndex="1",e.removeAttribute("drop-item")}static fixStackedCardsPosition(e,s,t,a){e.forEach((n,i)=>{n.style.position="fixed",n.style.left=`${s.clientX-t}px`,n.style.top=`${s.clientY-a+(i+1)*20}px`,n.style.zIndex=(i+1).toString(),n.removeAttribute("drop-item")})}static calculateDistance(e,s){const t={x:e.left+e.width/2,y:e.top+e.height/2},a={x:s.left+s.width/2,y:s.top+s.height/2};return Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))}static async moveElementsTo(e,s){e.forEach((t,a)=>{const n=s.top+20*a;t.style.top=`${n}px`,t.style.left=`${s.left}px`,t.classList.add("poker-card--animating"),t.classList.remove("poker-card--dragging"),t.classList.remove("poker-card--selected"),t.classList.remove("poker-card--selected__stack")}),await new Promise(t=>setTimeout(t,100)),e.forEach(t=>t.classList.remove("poker-card--animating"))}}window.DragAndDrop=d;
